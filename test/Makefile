src = ${wildcard *.c}
# Получить название исполняемых файлов тестов для каждого исходника
test = ${src:.c=.test}

test: $(test)

# Шаблонный рецепт, получающий исполняемый файл с тестом из его исходника
# Этот рецепт также выполняет тест и... сразу удаляет его.
# Можно убрать нижнюю строчку этого рецепта про удаление, если тебе это кажется нелогичным.
# В таком случае тест будет выполнятся только тогда, когда произовли изменения в библиотеке
%.test: %.c ..\src\lib${NAME}.a
	$(CC) $(CFLAGS) -DTEST -I..\src $< -L..\src -l$(NAME) -o $@
	$(GDB) ./$@
	@$(RM) $@

.PHONY: clean
clean:
	$(RM) $(test)