src = ${wildcard *.c}
obj = ${filter-out main.o,${src:.c=.o}}
dep = ${src:.c=.d}

lib$(NAME).a: $(obj)
	$(AR) rcs $@ $^


$(NAME): main.o lib$(NAME).a
	$(CC) $^ -o $@

# Включить содержимое всех сгенерированных файлов зависимостей
-include $(dep)

# Шаблонный рецепт, который получает файлы зависимостей для каждого исходного файла.
# Это удобно при редактировании заголовочных файлов, чтобы все исходники,
# использующие отредактированные заголовки автоматически пересобрались.
%.d: %.c
	@$(CPP) $(CFLAGS) $< -MM -MT $(@:.d=.o) > $@

.PHONY: clean
clean:
	$(RM) lib$(NAME).a $(obj) $(dep) $(NAME).exe main.o